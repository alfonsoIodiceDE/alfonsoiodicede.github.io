<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Linear Regression (part 1)</title>
    <meta charset="utf-8" />
    <meta name="author" content="Statistical Learning" />
    <script src="Linear-Regression-part_1_files/header-attrs/header-attrs.js"></script>
    <link href="Linear-Regression-part_1_files/animate.css/animate.xaringan.css" rel="stylesheet" />
    <script src="Linear-Regression-part_1_files/fabric/fabric.min.js"></script>
    <link href="Linear-Regression-part_1_files/xaringanExtra-scribble/scribble.css" rel="stylesheet" />
    <script src="Linear-Regression-part_1_files/xaringanExtra-scribble/scribble.js"></script>
    <script>document.addEventListener('DOMContentLoaded', function() { window.xeScribble = new Scribble({"pen_color":["#FF0000"],"pen_size":3,"eraser_size":30,"palette":[]}) })</script>
    <script src="Linear-Regression-part_1_files/kePrint/kePrint.js"></script>
    <link href="Linear-Regression-part_1_files/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Linear Regression (part 1)
## with tidymodels
### Statistical Learning
### Alfonso Iodice D'Enza

---





class: animated fadeIn center middle inverse

# prologue...

---
class: animated fadeIn 
### supervised learning flow

.my-pull-left[
**pre-processing**
]
.my-pull-right[
&gt; - split your observations in **training**, **validation** (or, cross-validate) and **test**
&gt;
&gt; - transform the predictors properly (** features engineering **) 
]

--

.my-pull-left[
**model-spec**
]
.my-pull-right[
&gt; - **specify** the model to fit
]

--

.my-pull-left[
**tuning**
]
.my-pull-right[
&gt; - select a reasonable grid of model **hyperparameter(s)** values to choose from
&gt; 
&gt; - for each combination of hyperparameters 

&gt;   - **fit** the model  on training observations
&gt;   - compute appropriate **metrics** on evaluation observations

&gt; 
&gt; - pick-up the **best** hyperparamters combination

]

--

.my-pull-left[
**final evaluation and fit**
]
.my-pull-right[
&gt; - compute the metric for the **tuned model** on the **test** set (observations never used yet)
&gt; 
&gt; - obtain the **final fit** for the model on all the available observations  
]

---
class: animated fadeIn 
### the tidymodels metapackage

** All the core packages in the tidymodels refer to one step of a supervised learning flow **

&lt;center&gt;
&lt;img src="./figures/tidymodels.png" alt="tidymodels logo" height="300px" /&gt;
&lt;/center&gt;

### For all things tidymodels check [tidymodels.org](https://www.tidymodels.org)!
---
class: animated fadeIn 
### the tidymodels core

** All the core packages in the tidymodels refer to one step of a supervised learning flow **

&lt;center&gt;
&lt;img src="./figures/tidymodels_all.jpeg" alt="all" height="500px" /&gt;
&lt;/center&gt;


---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{rsample}\)` ** package provides tools for data splitting and resampling

&lt;center&gt;
&lt;img src="./figures/tidymodels_rsample.jpeg" alt="rsample" height="500px" /&gt;
&lt;/center&gt;

---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{recipes}\)` ** package provides tools for data pre-processing and feature engineering

&lt;center&gt;
&lt;img src="./figures/tidymodels_recipes.jpeg" alt="recipes" height="500px" /&gt;
&lt;/center&gt;


---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{parsnip}\)` ** package provides a unified interface to recall several models available in R

&lt;center&gt;
&lt;img src="./figures/tidymodels_parsnip.jpeg" alt="parsnip" height="500px" /&gt;
&lt;/center&gt;

---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{workflows}\)` ** package  combines together pre-processing, modeling and post-processing steps

&lt;center&gt;
&lt;img src="./figures/tidymodels_workflows.jpeg" alt="workflows" height="500px" /&gt;
&lt;/center&gt;

---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{yardstick}\)` ** package  provides several performance metrics

&lt;center&gt;
&lt;img src="./figures/tidymodels_yardstick.jpeg" alt="yardstick" height="500px" /&gt;
&lt;/center&gt;


---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{dials}\)` ** package provides tools to define hyperparameters value grids

&lt;center&gt;
&lt;img src="./figures/tidymodels_dials.jpeg" alt="dials" height="500px" /&gt;
&lt;/center&gt;

---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{tune}\)` ** package remarkably simplifies the hyperparameters optimization implementation

&lt;center&gt;
&lt;img src="./figures/tidymodels_tune.jpeg" alt="tune" height="500px" /&gt;
&lt;/center&gt;

---
class: animated fadeIn 
### the tidymodels core

the ** `\(\texttt{broom}\)` ** package provides utility functions to tidify model output

&lt;center&gt;
&lt;img src="./figures/tidymodels_broom.jpeg" alt="tune" height="500px" /&gt;
&lt;/center&gt;

---
class: animated fadeIn center middle inverse

# ...end of prologue


---
class: animated fadeIn 
### Advertising data

```r
adv_data = read_csv(file="./data/Advertising.csv") %&gt;% select(-1)
adv_data %&gt;% slice_sample(n = 8) %&gt;% 
  kbl() %&gt;% kable_styling(font_size=10)
```

&lt;table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; TV &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; radio &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; newspaper &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sales &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 25.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 25.7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 8.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 198.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 49.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 60.0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 23.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 184.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 43.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1.7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 69.2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 20.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.3 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 163.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 36.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 234.5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 84.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 11.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 21.7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 50.4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 7.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 131.1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 28.9 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 18.0 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

- ** sales ** is the response, indicating the level of sales in a specific market
- ** TV **, ** Radio ** and ** Newspaper ** are the predictors, indicating the advertising budget spent on the corresponding media

---
class: animated fadeIn 

### Advertising data

```r
adv_data_tidy = adv_data %&gt;% pivot_longer(names_to="medium",values_to="budget",cols = 1:3) 
adv_data_tidy %&gt;% slice_sample(n = 8) %&gt;% 
  kbl() %&gt;% kable_styling(font_size=10)
```

&lt;table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:right;"&gt; sales &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; medium &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; budget &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15.2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 65.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 25.5 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 42.0 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18.9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 22.9 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14.8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 280.2 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 10.8 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 5.8 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 15.9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 16.7 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 18.9 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 27.5 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:right;"&gt; 14.6 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 78.2 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: animated fadeIn 
### Advertising data

```r
adv_data_tidy %&gt;% 
  ggplot(aes(x = budget, y = sales)) + theme_minimal() + facet_wrap(~medium,scales = "free") +
  geom_point(color="indianred",alpha=.5,size=3)
```

&lt;img src="Linear-Regression-part_1_files/figure-html/advert_plot-1.png" width="50%" style="display: block; margin: auto;" /&gt;

--
**Note**: the budget spent on TV is up to 300, less so for Radio and Newspaper  

---
class: animated fadeIn 
### Advertising data: single regressions

We can be **naive** and regress ** `\(\texttt{sales}\)` **  on ** `\(\texttt{tv}\)` **,  ** `\(\texttt{newspaper}\)` ** and  ** `\(\texttt{radio}\)` **, separately.


---
class: animated fadeIn 

### Advertising data: single regressions

```r
*avd_lm_models_nest = adv_data_tidy %&gt;%
*                 group_by(medium) %&gt;%
*                 group_nest(.key = "datasets") %&gt;%
                  mutate(
                    model_output = map(.x=datasets,~lm(sales~budget,data=.x)),
                         model_params = map(.x=model_output, ~tidy(.x)),
                         model_metrics = map(.x=model_output, ~glance(.x)),
                         model_fitted = map(.x=model_output, ~augment(.x))
                  )
```


```
## # A tibble: 3 × 2
##   medium              datasets
##   &lt;chr&gt;     &lt;list&lt;tibble[,2]&gt;&gt;
## 1 newspaper          [200 × 2]
## 2 radio              [200 × 2]
## 3 TV                 [200 × 2]
```

---
class: animated fadeIn 

### Advertising data: single regressions

```r
avd_lm_models_nest = adv_data_tidy %&gt;% 
                  group_by(medium) %&gt;% 
                  group_nest(.key = "datasets") %&gt;% 
*                 mutate(
*                   model_output = map(.x=datasets,~lm(sales~budget,data=.x)),
                         model_params = map(.x=model_output, ~tidy(.x)),
                         model_metrics = map(.x=model_output, ~glance(.x)),
                         model_fitted = map(.x=model_output, ~augment(.x))
*                 )
```


```
## # A tibble: 3 × 3
##   medium              datasets model_output
##   &lt;chr&gt;     &lt;list&lt;tibble[,2]&gt;&gt; &lt;list&gt;      
## 1 newspaper          [200 × 2] &lt;lm&gt;        
## 2 radio              [200 × 2] &lt;lm&gt;        
## 3 TV                 [200 × 2] &lt;lm&gt;
```


---
class: animated fadeIn 

### Advertising data: single regressions

```r
avd_lm_models_nest = adv_data_tidy %&gt;% 
                  group_by(medium) %&gt;% 
                  group_nest(.key = "datasets") %&gt;% 
*                 mutate(
*                   model_output = map(.x=datasets,~lm(sales~budget,data=.x)),
*                        model_params = map(.x=model_output, ~tidy(.x)),
                         model_metrics = map(.x=model_output, ~glance(.x)),
                         model_fitted = map(.x=model_output, ~augment(.x))
*                 )
```


```
## # A tibble: 3 × 4
##   medium              datasets model_output model_params    
##   &lt;chr&gt;     &lt;list&lt;tibble[,2]&gt;&gt; &lt;list&gt;       &lt;list&gt;          
## 1 newspaper          [200 × 2] &lt;lm&gt;         &lt;tibble [2 × 5]&gt;
## 2 radio              [200 × 2] &lt;lm&gt;         &lt;tibble [2 × 5]&gt;
## 3 TV                 [200 × 2] &lt;lm&gt;         &lt;tibble [2 × 5]&gt;
```

---
class: animated fadeIn 

### Advertising data: single regressions

```r
avd_lm_models_nest = adv_data_tidy %&gt;% 
                  group_by(medium) %&gt;% 
                  group_nest(.key = "datasets") %&gt;% 
*                 mutate(
*                   model_output = map(.x=datasets,~lm(sales~budget,data=.x)),
*                        model_params = map(.x=model_output, ~tidy(.x)),
*                        model_metrics = map(.x=model_output, ~glance(.x)),
                         model_fitted = map(.x=model_output, ~augment(.x))
*                 )
```


```
## # A tibble: 3 × 5
##   medium              datasets model_output model_params     model_metrics    
##   &lt;chr&gt;     &lt;list&lt;tibble[,2]&gt;&gt; &lt;list&gt;       &lt;list&gt;           &lt;list&gt;           
## 1 newspaper          [200 × 2] &lt;lm&gt;         &lt;tibble [2 × 5]&gt; &lt;tibble [1 × 12]&gt;
## 2 radio              [200 × 2] &lt;lm&gt;         &lt;tibble [2 × 5]&gt; &lt;tibble [1 × 12]&gt;
## 3 TV                 [200 × 2] &lt;lm&gt;         &lt;tibble [2 × 5]&gt; &lt;tibble [1 × 12]&gt;
```

---
class: animated fadeIn 

### Advertising data: single regressions

```r
avd_lm_models_nest = adv_data_tidy %&gt;% 
                  group_by(medium) %&gt;% 
                  group_nest(.key = "datasets") %&gt;% 
*                 mutate(
*                   model_output = map(.x=datasets,~lm(sales~budget,data=.x)),
*                        model_params = map(.x=model_output, ~tidy(.x)),
*                        model_metrics = map(.x=model_output, ~glance(.x)),
*                        model_fitted = map(.x=model_output, ~augment(.x))
*                 )
```


```
## # A tibble: 3 × 6
##   medium           datasets model_output model_params model_metrics model_fitted
##   &lt;chr&gt;     &lt;list&lt;tibble[,&gt; &lt;list&gt;       &lt;list&gt;       &lt;list&gt;        &lt;list&gt;      
## 1 newspaper       [200 × 2] &lt;lm&gt;         &lt;tibble&gt;     &lt;tibble&gt;      &lt;tibble&gt;    
## 2 radio           [200 × 2] &lt;lm&gt;         &lt;tibble&gt;     &lt;tibble&gt;      &lt;tibble&gt;    
## 3 TV              [200 × 2] &lt;lm&gt;         &lt;tibble&gt;     &lt;tibble&gt;      &lt;tibble&gt;
```
--
This is a ** nested data structure ** with everything stored. The functions `\(\texttt{tidy}\)`, `\(\texttt{glance}\)` and 
`\(\texttt{augment}\)`  pull all the information off of the model output, and arrange it in a tidy way.

---
class: animated fadeIn 
### Advertising data: nested structure

The quantities nested in the tibble can be pulled out, or they can be *expanded* within the tibble itself, using 
`\(\texttt{unnest}\)`


```r
avd_lm_models_nest  %&gt;% unnest(model_params) 
```

```
## # A tibble: 6 × 10
##   medium       datasets model_output term  estimate std.error statistic  p.value
##   &lt;chr&gt;     &lt;list&lt;tibb&gt; &lt;list&gt;       &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 newspaper   [200 × 2] &lt;lm&gt;         (Int…  12.4      0.621       19.9  4.71e-49
## 2 newspaper   [200 × 2] &lt;lm&gt;         budg…   0.0547   0.0166       3.30 1.15e- 3
## 3 radio       [200 × 2] &lt;lm&gt;         (Int…   9.31     0.563       16.5  3.56e-39
## 4 radio       [200 × 2] &lt;lm&gt;         budg…   0.202    0.0204       9.92 4.35e-19
## 5 TV          [200 × 2] &lt;lm&gt;         (Int…   7.03     0.458       15.4  1.41e-35
## 6 TV          [200 × 2] &lt;lm&gt;         budg…   0.0475   0.00269     17.7  1.47e-42
## # … with 2 more variables: model_metrics &lt;list&gt;, model_fitted &lt;list&gt;
```

---
class: animated fadeIn 
### Advertising data: nested structure

The quantities nested in the tibble can be pulled out, or they can be *expanded* within the tibble itself, using 
`\(\texttt{unnest}\)`


```r
avd_lm_models_nest  %&gt;% unnest(model_params) %&gt;% 
  select(medium,term:p.value) %&gt;%
  kbl(digits = 4) %&gt;% kable_styling(font_size = 10) %&gt;% 
  row_spec(1:2,background = "#D9FDEC") %&gt;% 
  row_spec(3:4,background = "#CAF6FC") %&gt;% 
  row_spec(5:6,background = "#FDB5BA")
```

&lt;table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; medium &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 12.3514 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.6214 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 19.8761 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0547 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0166 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 3.2996 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0011 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 9.3116 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.5629 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 16.5422 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.2025 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0204 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 9.9208 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 7.0326 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.4578 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 15.3603 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0475 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0027 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 17.6676 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

--

&amp;nbsp;
&amp;nbsp;

The effect of budget on sales differs significantly from 0, for all the considered media 


---
class: animated fadeIn 
### Ordinary least squares 

** `$$\min_{\hat{\beta}_{0},\hat{\beta}_{1}}: RSS=\sum_{i=1}^{n}{e_{i}^{2}}=\sum_{i=1}^{n}{(y_{i}-\hat{y}_{i})^{2}}=\sum_{i=1}^{n}{(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i})^{2}}$$` **

--

### OLS estimator of `\(\beta_{0}\)`

`$$\begin{split}&amp;\partial_{\hat{\beta}_{0}}\sum_{i=1}^{n}{(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i})^{2}}=
-2\sum_{i=1}^{n}{(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i})}=\\
&amp;\sum_{i=1}^{n}{y_{i}}-n\hat{\beta}_{0}-\hat{\beta}_{1}\sum_{i=1}^{n}{x_{i}}=0\rightarrow
\hat{\beta}_{0}=\bar{y}-\hat{\beta}_{1}\bar{x}\end{split}$$`


---
class: animated fadeIn 
### Ordinary least squares 

** `$$\min_{\hat{\beta}_{0},\hat{\beta}_{1}}\sum_{i=1}^{n}{e_{i}^{2}}=\sum_{i=1}^{n}{(y_{i}-\hat{y}_{i})^{2}}=\sum_{i=1}^{n}{(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i})^{2}}$$` **


### OLS estimator of `\(\beta_{1}\)`

`$$\begin{split}&amp;\partial_{\hat{\beta}_{1}}\sum_{i=1}^{n}{(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i})^{2}}=
-2\sum_{i=1}^{n}{x_{i}(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i})}= 
\sum_{i=1}^{n}{x_{i}y_{i}}-\hat{\beta}_{0}\sum_{i=1}^{n}{x_{i}}-\hat{\beta}_{1}\sum_{i=1}^{n}{x_{i}^{2}}=0\\
&amp;\hat{\beta}_{1}\sum_{i=1}^{n}{x_{i}^{2}}=\sum_{i=1}^{n}{x_{i}y_{i}}-\sum_{i=1}^{n}{x_{i}}\left(\frac{\sum_{i=1}^{n}{y_{i}}}{n}-\hat{\beta}_{1}\frac{\sum_{i=1}^{n}{x_{i}}}{n}\right)\\
&amp;\hat{\beta}_{1}\left(n\sum_{i=1}^{n}{x_{i}^{2}}-(\sum_{i=1}^{n}{x_{i}})^{2} \right)=
n\sum_{i=1}^{n}{x_{i}y_{i}}-\sum_{i=1}^{n}{x_{i}}\sum_{i=1}^{n}{y_{i}}\\
&amp;\hat{\beta}_{1}=\frac{n\sum_{i=1}^{n}{x_{i}y_{i}}-\sum_{i=1}^{n}{x_{i}}\sum_{i=1}^{n}{y_{i}}}
{n\sum_{i=1}^{n}{x_{i}^{2}}-(\sum_{i=1}^{n}{x_{i}})^{2} }=\frac{\sigma_{xy}}{\sigma^{2}_{x}}
\end{split}$$`


---
class: animated fadeIn 
### Three regression lines


```r
*three_regs_plot=avd_lm_models_nest  %&gt;% unnest(model_fitted) %&gt;%
* select(medium,sales:.fitted) %&gt;%
* ggplot(aes(x=budget,y=sales))+theme_minimal()+facet_grid(~medium,scales="free")+
  geom_point(alpha=.5,color = "indianred")+
  geom_smooth(method="lm")+
  geom_segment(aes(x=budget,xend=budget,y=.fitted,yend=sales),color="forestgreen",alpha=.25)
```
&lt;img src="Linear-Regression-part_1_files/figure-html/unnamed-chunk-1-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---
class: animated fadeIn 
### Three regression lines


```r
*three_regs_plot = avd_lm_models_nest  %&gt;% unnest(model_fitted) %&gt;%
* select(medium,sales:.fitted) %&gt;%
* ggplot(aes(x=budget,y=sales))+theme_minimal()+facet_grid(~medium,scales="free")+
* geom_point(alpha=.5,color = "indianred")+
  geom_smooth(method="lm")+
  geom_segment(aes(x=budget,xend=budget,y=.fitted,yend=sales),color="forestgreen",alpha=.25)
```

&lt;img src="Linear-Regression-part_1_files/figure-html/unnamed-chunk-2-1.png" width="40%" style="display: block; margin: auto;" /&gt;


---
class: animated fadeIn 
### Three regression lines


```r
*three_regs_plot=avd_lm_models_nest  %&gt;% unnest(model_fitted) %&gt;%
* select(medium,sales:.fitted) %&gt;%
* ggplot(aes(x=budget,y=sales))+theme_minimal()+facet_grid(~medium,scales="free")+
* geom_point(alpha=.5,color = "indianred")+
* geom_smooth(method="lm")+
  geom_segment(aes(x=budget,xend=budget,y=.fitted,yend=sales),color="forestgreen",alpha=.25)
```

&lt;img src="Linear-Regression-part_1_files/figure-html/unnamed-chunk-3-1.png" width="40%" style="display: block; margin: auto;" /&gt;

---
class: animated fadeIn 
### Three regression lines


```r
*three_regs_plot=avd_lm_models_nest  %&gt;% unnest(model_fitted) %&gt;%
* select(medium,sales:.fitted) %&gt;%
* ggplot(aes(x=budget,y=sales))+theme_minimal()+facet_grid(~medium,scales="free")+
* geom_point(alpha=.5,color = "indianred")+
* geom_smooth(method="lm")+
* geom_segment(aes(x=budget,xend=budget,y=.fitted,yend=sales),color="forestgreen",alpha=.25)
```

&lt;img src="Linear-Regression-part_1_files/figure-html/unnamed-chunk-4-1.png" width="40%" style="display: block; margin: auto;" /&gt;



---
class: animated fadeIn 
### Advertising data: nested structure

The quantities nested in the tibble can be pulled out, or they can be *expanded* within the tibble itself, using 
`\(\texttt{unnest}\)`


```r
avd_lm_models_nest  %&gt;% unnest(model_metrics) %&gt;% 
  select(medium,r.squared:df.residual) %&gt;%
  kbl(digits = 4) %&gt;% kable_styling(font_size = 10) %&gt;% 
  row_spec(1,background = "#D9FDEC") %&gt;% 
  row_spec(2,background = "#CAF6FC") %&gt;% 
  row_spec(3,background = "#FDB5BA")
```

&lt;table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; medium &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; r.squared &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; adj.r.squared &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; sigma &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; df &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; logLik &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; AIC &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; BIC &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; deviance &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; df.residual &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0521 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0473 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 5.0925 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 10.8873 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0011 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; -608.3357 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 1222.671 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 1232.566 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 5134.805 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 198 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.3320 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.3287 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 4.2749 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 98.4216 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; -573.3369 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 1152.674 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 1162.569 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 3618.479 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 198 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.6119 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.6099 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 3.2587 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 312.1450 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 1 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; -519.0457 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 1044.091 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 1053.986 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 2102.531 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 198 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
class: animated fadeIn 

### Linear regression: model assumptions

The linear regression model is

** `$$y_{i}=\beta_{0}+\beta_{1}x_{1}+\epsilon_{i}$$` **

where ** `\(\epsilon_{i}\)` ** is a random variable with expected value of **0**. 
For inference, more assumptions must me made:

- ** `\(\epsilon_{i}\sim N(0,\sigma^{2})\)` **, then the variance of the errors ** `\(\sigma^{2}\)` ** does not depend on ** `\(x_{i}\)` **. 

- ** `\(Cov(\epsilon_{i},\epsilon_{i'})=0\)` **, for all `\(i\neq i'\)` and `\(i,i'=1,\ldots,n\)`.

- ** `\(x_{i}\)` ** non stochastic

--

It follows that ** `\(y_{i}\)` ** is a random variable such that 

- ** `\(E[y_{i}]=\beta_{0}+\beta_{1}x_{1}\)` **
- ** `\(Var[y_{i}]=\sigma^{2}\)` **

---
class: animated fadeIn 

### Linear regression: model assumptions

&lt;center&gt;
&lt;img src="./figures/RegAssum.png" alt="RegAssum" height="500px" /&gt;
&lt;/center&gt;
&lt;center&gt;
Statistics for Business and Economics (Anderson, Sweeney and Williams, (2011))
&lt;/center&gt;

---
class: animated fadeIn 
### `\(\sigma^{2}\)` estimator

The  variance ** `\(\sigma^{2}\)` ** is assumed to be constant, but it is unknown, and it has to be estimated:

- since ** `\(y_{i}\sim N(\beta_{0}+\beta_{1}x_{i},\sigma^{2})\)` **, it follows that

** `$$\frac{y_{i}-\beta_{0}-\beta_{1}x_{i}}{\sigma}\sim N(0,1)$$` **

--

- furthermore, recall that  ** `\(\sum_{i=1}^{n}\left[N(0,1)\right]^{2} = \chi^{2}_{n}\)` **, then

** `$$\sum_{i=1}^{n}\left[N(0,1)\right]^{2}=\sum_{i=1}^{n}\left[\frac{y_{i}-\beta_{0}-\beta_{1}x_{i}}{\sigma}\right]^{2}=\chi^{2}_{n}$$` **

--

- replacing ** `\(\beta_{0}\)` ** and ** `\(\beta_{1}\)` ** with their estimators ** `\(\hat{\beta}_{0}\)` ** and ** `\(\hat{\beta}_{1}\)` **,
the previous becomes

** `$$\frac{\sum_{i=1}^{n}\left(y_{i}-\hat{\beta}_{0}-\hat{\beta}_{1}x_{i}\right)^{2}}{\sigma^{2}}=\frac{RSS}{\sigma^{2}}=\chi^{2}_{n-2}$$` ** two degree of freedom are lost as the two parameters are replaced by their estimators. 

---
class: animated fadeIn 
### `\(\sigma^{2}\)` estimator

- Finally, since ** `\(E\left[\chi^{2}_{n-2}\right]=n-2\)` ** then

** `$$E\left[\chi^{2}_{n-2}\right]=E\left[\frac{RSS}{\sigma^{2}}\right]=n-2$$` ** 

- and because ** `\(\sigma^{2}\)` ** is constant, it can be pulled out from the expectation, and re-write

** `$$\frac{E\left[RSS\right]}{\sigma^{2}}=n-2$$` **

- it follows that
** `$$\sigma^{2}=E\left[\frac{RSS}{n-2}\right]$$` **
and ** `\(\frac{RSS}{n-2}\)` ** is an unbiased estimator of `\(\sigma^{2}\)`.

- ** `\(\sqrt{\frac{RSS}{n-2}}=RSE\)` **, the so-called **residual standard error**

---
class: animated fadeIn 
### `\(\hat{\beta}_{1}\)` as a linear combination of `\(y_{i}\)`

`$$\begin{split}
\hat{\beta}_{1}&amp;= \frac{\sum_{i=1}^{n}{\left(y_{i}-\bar{y}\right)\left(x_{i}-\bar{x}\right)} }{\sum_{i=1}^{n}{\left(x_{i}-\bar{x}\right)^{2}}}
=\frac{\sum_{i=1}^{n}{\left[y_{i} \left(x_{i}-\bar{x}\right) -\bar{y}\left(x_{i}-\bar{x}\right)\right]} }{\sum_{i=1}^{n}{\left(x_{i}-\bar{x}\right)^{2}}}=\\
&amp;=\frac{\sum_{i=1}^{n}{y_{i} \left(x_{i}-\bar{x}\right)} -\bar{y}\sum_{i=1}^{n}{\left(x_{i}-\bar{x}\right)}}{\sum_{i=1}^{n}{\left(x_{i}-\bar{x}\right)^{2}}}
= \sum_{i=1}^{n}{y_{i} \frac{\left(x_{i}-\bar{x}\right)}{\sum_{i=1}^{n}{\left(x_{i}-\bar{x}\right)^{2}}}}=
\sum_{i=1}^{n}{w_{i}y_{i}}\end{split}$$`

Given a linear combination `\(U_{i}=c+d V_{i}\)`, if `\(V_{i}\sim N(\mu_{v},\sigma^{2}_{v})\)`, then 
`\(U_{i}\sim N(c+d\mu_{v},d^{2}\sigma^{2}_{v})\)`.

Since `\(Y_{i}\sim N(\beta_{0}+\beta_{1}x_{i},\sigma^{2})\)`, and `\(\hat{\beta}_{1}=\sum_{i=1}^{n}{w_{i}y_{i}}\)` then `\(c=0\)` and `\(d=w_{i}\)`, then 

** `$$\hat{\beta}_{1}\sim N(\sum_{i=1}^{n}{w_{i}(\beta_{0}+\beta_{1}x_{i})},\sum_{i=1}^{n}{w_{i}^{2}\sigma^{2}})$$` **

---
class: animated fadeIn 

### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(E\left[\hat{\beta}_{1}\right]=\beta_{1}\)`

The expectation of ** `\(\hat{\beta}_{1}\)` ** is 

- ** `\(E\left[\hat{\beta}_{1}\right] = \sum_{i=1}^{n}{w_{i}(\beta_{0}+\beta_{1}x_{i})} = \beta_{0}\underbrace{\sum_{i=1}^{n}{w_{i}}}_{0}+\beta_{1}\sum_{i=1}^{n}{w_{i}x_{i}}=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\)` **

--

    ** `\(=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\)` **


---
class: animated fadeIn 

### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(E\left[\hat{\beta}_{1}\right]=\beta_{1}\)`

The expectation of ** `\(\hat{\beta}_{1}\)` ** is 

- ** `\(E\left[\hat{\beta}_{1}\right] = \sum_{i=1}^{n}{w_{i}(\beta_{0}+\beta_{1}x_{i})} = \beta_{0}\underbrace{\sum_{i=1}^{n}{w_{i}}}_{0}+\beta_{1}\sum_{i=1}^{n}{w_{i}x_{i}}=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\)` **



  ** `\(=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\beta_{1}\frac{\sum_{i=1}^{n}{(x_{i}-\bar{x})x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\)` **


---
class: animated fadeIn 

### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(E\left[\hat{\beta}_{1}\right]=\beta_{1}\)`

The expectation of ** `\(\hat{\beta}_{1}\)` ** is 

- ** `\(E\left[\hat{\beta}_{1}\right] = \sum_{i=1}^{n}{w_{i}(\beta_{0}+\beta_{1}x_{i})} = \beta_{0}\underbrace{\sum_{i=1}^{n}{w_{i}}}_{0}+\beta_{1}\sum_{i=1}^{n}{w_{i}x_{i}}=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\)` **



  ** `\(=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\beta_{1}\frac{\sum_{i=1}^{n}{(x_{i}-\bar{x})x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\beta_{1}\frac{\sum_{i=1}^{n}{x_{i}^2}-\bar{x}\sum_{i=1}^{n}{x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)` **

---
class: animated fadeIn 

### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(E\left[\hat{\beta}_{1}\right]=\beta_{1}\)`

The expectation of ** `\(\hat{\beta}_{1}\)` ** is 

- ** `\(E\left[\hat{\beta}_{1}\right] = \sum_{i=1}^{n}{w_{i}(\beta_{0}+\beta_{1}x_{i})} = \beta_{0}\underbrace{\sum_{i=1}^{n}{w_{i}}}_{0}+\beta_{1}\sum_{i=1}^{n}{w_{i}x_{i}}=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\)` **



  ** `\(=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\beta_{1}\frac{\sum_{i=1}^{n}{(x_{i}-\bar{x})x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\beta_{1}\frac{\sum_{i=1}^{n}{x_{i}^2}-\bar{x}\sum_{i=1}^{n}{x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\beta_{1}\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\sum_{i=1}^{n}{x_{i}^2}-\frac{\sum_{i=1}^{n}{x_{i}}}{n}\sum_{i=1}^{n}{x_{i}}=\)` **

---
class: animated fadeIn 

### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(E\left[\hat{\beta}_{1}\right]=\beta_{1}\)`

The expectation of ** `\(\hat{\beta}_{1}\)` ** is 

- ** `\(E\left[\hat{\beta}_{1}\right] = \sum_{i=1}^{n}{w_{i}(\beta_{0}+\beta_{1}x_{i})} = \beta_{0}\underbrace{\sum_{i=1}^{n}{w_{i}}}_{0}+\beta_{1}\sum_{i=1}^{n}{w_{i}x_{i}}=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\)` **

  ** `\(=\beta_{1}\sum_{i=1}^{n}{\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}x_{i}}=\beta_{1}\frac{\sum_{i=1}^{n}{(x_{i}-\bar{x})x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\beta_{1}\frac{\sum_{i=1}^{n}{x_{i}^2}-\bar{x}\sum_{i=1}^{n}{x_{i}}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\beta_{1}\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\sum_{i=1}^{n}{x_{i}^2}-\frac{\sum_{i=1}^{n}{x_{i}}}{n}\sum_{i=1}^{n}{x_{i}}=\)` **


  ** `\(=\beta_{1}\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\frac{n\sum_{i=1}^{n}{x_{i}^2}-\left[\sum_{i=1}^{n}{x_{i}}\right]^2}{n}=\)` **


Note: 
  `\(\frac{n\sum_{i=1}^{n}{x_{i}^2}-\left[\sum_{i=1}^{n}{x_{i}}\right]^2}{n} \frac{1}{n} =\frac{n\sum_{i=1}^{n}{x_{i}^2}}{n^{2}}-\frac{\left[\sum_{i=1}^{n}{x_{i}}\right]^2}{n^{2}}=\frac{\sum_{i=1}^{n}{x_{i}^2}}{n}-\bar{x}^{2}=var(x)\)`
  
--

  therefore `\(\frac{n\sum_{i=1}^{n}{x_{i}^2}-\left[\sum_{i=1}^{n}{x_{i}}\right]^2}{n} = var(x)n=\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\)`

--

  ** `\(=\beta_{1}\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\frac{n\sum_{i=1}^{n}{x_{i}^2}-\left[\sum_{i=1}^{n}{x_{i}}\right]^2}{n}=\beta_{1}\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}=\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}=\beta_{1}\)` **

---
class: animated fadeIn 
### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(var\left(\hat{\beta}_{1}\right) = \frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)`

The variance of ** `\(\hat{\beta}_{1}\)` ** is 


 ** `\(var\left(\hat{\beta}_{1}\right) = \sum_{i=1}^{n}{w^{2}_{i}\sigma^{2}}=\)` **


---
class: animated fadeIn 
### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(var\left(\hat{\beta}_{1}\right) = \frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)`

The variance of ** `\(\hat{\beta}_{1}\)` ** is 


** `\(var\left(\hat{\beta}_{1}\right) = \sum_{i=1}^{n}{w^{2}_{i}\sigma^{2}} =\sum_{i=1}^{n}{\left[\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\right]^{2}}\sigma^{2}\)` **

---
class: animated fadeIn 
### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(var\left(\hat{\beta}_{1}\right) = \frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)`

The variance of ** `\(\hat{\beta}_{1}\)` ** is 


** `\(var\left(\hat{\beta}_{1}\right) = \sum_{i=1}^{n}{w^{2}_{i}\sigma^{2}} =\sum_{i=1}^{n}{\left[\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\right]^{2}}\sigma^{2}=\sum_{i=1}^{n}{\frac{(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}\)` **

---
class: animated fadeIn 
### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(var\left(\hat{\beta}_{1}\right) = \frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)`

The variance of ** `\(\hat{\beta}_{1}\)` ** is 


** `\(var\left(\hat{\beta}_{1}\right) = \sum_{i=1}^{n}{w^{2}_{i}\sigma^{2}} =\sum_{i=1}^{n}{\left[\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\right]^{2}}\sigma^{2}=\sum_{i=1}^{n}{\frac{(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}={\frac{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}\)` **

---
class: animated fadeIn 
### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(var\left(\hat{\beta}_{1}\right) = \frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)`

The variance of ** `\(\hat{\beta}_{1}\)` ** is 

** `\(var\left(\hat{\beta}_{1}\right) = \sum_{i=1}^{n}{w^{2}_{i}\sigma^{2}} =\sum_{i=1}^{n}{\left[\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\right]^{2}}\sigma^{2}=\sum_{i=1}^{n}{\frac{(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}={\frac{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}={\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}}\sigma^{2}\)` **

---
class: animated fadeIn 
### Parameters of the `\(\hat{\beta}_{1}\)` distribution: `\(var\left(\hat{\beta}_{1}\right) = \frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\)`

The variance of ** `\(\hat{\beta}_{1}\)` ** is 

** `\(var\left(\hat{\beta}_{1}\right) = \sum_{i=1}^{n}{w^{2}_{i}\sigma^{2}} =\sum_{i=1}^{n}{\left[\frac{x_{i}-\bar{x}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}\right]^{2}}\sigma^{2}=\sum_{i=1}^{n}{\frac{(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}={\frac{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}{\left[\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}\right]^{2}}}\sigma^{2}={\frac{1}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}}\sigma^{2}\)` **

--
And the standard error of  ** `\(\hat{\beta}_{1}\)` ** is 

** `\(SE\left(\hat{\beta}_{1}\right) = \sqrt{\frac{\sigma^{2}}{\sum_{i=1}^{n}(x_{i}-\bar{x})^{2}}}\)` **

---
class: animated fadeIn 
### Inference on `\(\hat{\beta}_{1}\)`: hypothesis testing

The null hypothesis is ** `\(\beta_{1}=0\)` ** and the test statistic is 

** `$$\frac{\hat{\beta}_{1}-\beta_{1}}{SE(\hat{\beta}_{1})}$$` **

that, under the null hypothesis becomes just ** `\(\frac{\hat{\beta}_{1}}{SE(\hat{\beta}_{1})}\)` **  distributed as a *Student t* with n-2 d.f.



** `$$\text{Reject } H_{0} \text{ if } \left|\frac{\hat{\beta}_{1}}{SE(\hat{\beta}_{1})}\right|&gt;t_{1-\frac{\alpha}{2},n-2}$$` **


---
class: animated fadeIn 

### Linear regression: multiple predictors

- ** `\(y\)` ** is the numeric response; ** `\(X_{1},\ldots,X_{p}\)` ** are the predictors, the general formula for the linear model is
** `$$y = f(X)+\epsilon=\beta_{0}+\sum_{j=1}^{p}X_{j}\beta_{j}+ \epsilon$$` **

--
In algebraic form 

** `$${\bf y}={\bf X}{\bf \beta}+{\bf \epsilon}$$` **

`$$\begin{bmatrix} 
y_{1}\\
y_{2}\\
y_{3}\\
\vdots\\
y_{n}
\end{bmatrix}=\begin{bmatrix}
1&amp; x_{1,1}&amp;\ldots&amp;x_{1,p}\\
1&amp; x_{2,1}&amp;\ldots&amp;x_{2,p}\\
1&amp; x_{3,1}&amp;\ldots&amp;x_{3,p}\\
\vdots&amp;\vdots&amp;\vdots&amp;\\
1&amp; x_{n,1}&amp;\ldots&amp;x_{n,p}\\
\end{bmatrix}\begin{bmatrix}
\beta_{0}\\
\beta_{1}\\
\vdots\\
\beta_{p}\\
\end{bmatrix}+\begin{bmatrix}
\epsilon_{1}\\
\epsilon_{2}\\
\epsilon_{3}\\
\vdots\\
\epsilon_{n}
\end{bmatrix}$$`

---
class: animated fadeIn
### Linear regression: ordinary least square (OLS)

** OLS target **

** `$$\min_{\hat{\beta}_{0},\hat{\beta}_{1},\ldots,\hat{\beta}_{p}}\left(\sum_{i=1}^{n}y_{i}-\hat{\beta}_{0}-\sum_{j=1}^{p}X_{j}\beta_{j}\right)^{2}=\min_{\hat{\beta}_{0},\hat{\beta}_{1},\ldots,\hat{\beta}_{p}}RSS$$` ** 



--
** OLS target (algebraic) **
### $$ \min_{\hat{\beta}}  ({\bf y}-{\bf X}{\bf \hat{\beta}})^{\sf T}({\bf y}-{\bf X}{\bf \hat{\beta}})$$


---
class: animated fadeIn
### Linear regression: ordinary least square (OLS) solution
** OLS target  **
** `$$\min_{\hat{\beta}}({\bf y}-{\bf X}{\bf \hat{\beta}})^{\sf T}({\bf y}-{\bf X}{\bf \hat{\beta}})=\min_{\hat{\beta}}\left({\bf y}^{\sf T}{\bf y}-{\bf y}^{\sf T}{\bf X} {\bf \hat{\beta}}-{\bf{\hat{\beta}}}^{\sf T}{\bf X}^{\sf T}{\bf y}+{\bf {\hat{\beta}}}^{\sf T}{\bf X}^{\sf T}{\bf X} {\bf \hat{\beta}}\right)$$` **

--

** First order conditions  **

** `$$\partial_{\hat{\beta}}\left({\bf y}^{\sf T}{\bf y}-{\bf y}^{\sf T}{\bf X} {\bf \hat{\beta}}-{\bf{\hat{\beta}}}^{\sf T}{\bf X}^{\sf T}{\bf y}+{\bf {\hat{\beta}}}^{\sf T}{\bf X}^{\sf T}{\bf X} {\bf \hat{\beta}}\right)=0$$` **

--

Since ** `\(\partial_{\bf\hat{\beta}}\left({\bf y}^{\sf T}{\bf X} {\bf \hat{\beta}}\right)=\partial_{\bf\hat{\beta}}\left({ \bf {\hat{\beta}}}^{\sf T}{\bf X}^{\sf T}{\bf y}\right)={\bf X}^{\sf T}{\bf y}\)` ** it results that

** `$$\partial_{\hat{\beta}}RSS=-2{\bf X}^{\sf T}{\bf y}+2{\bf X}^{\sf T}{\bf X} {\bf \hat{\beta}}=0$$` **

And the ** OLS solution ** is

### $$ \hat{\beta} = ({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}{\bf y} $$


---
class: animated fadeIn

### Distributional assumptions

** `\(\epsilon \sim N(0,\sigma^{2}{\bf I})\)` **, assuming non-stochastic predictors, it follows that

** `$$E[{\bf y}]= E[{\bf X}\beta+\epsilon]={\bf X}\beta \ \ \text{ and } \ \ var[{\bf y}]= \sigma^{2}{\bf I}$$` **

--
### Distribution of linear combinations

** $$ \text{if } \quad {\bf U}\sim N({\bf \mu},{\bf\Sigma}) \quad \text{ and } \quad {\bf V} = {\bf c}+{\bf D}{\bf U} \quad \text{then} \quad {\bf V}\sim N({\bf c}+{\bf D}\mu,{\bf D}{\bf \Sigma}{\bf D}^{\sf T})$$ **

--
### Distribution of `\(\hat{\beta}\)`

 ** `\(\hat{\beta} =  ({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}{\bf y}\)` ** is a linear combination of ** `\(\bf y\)` **, with
** `\({\bf c} = 0\)` ** and ** `\({\bf D} = ({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}\)` **, then

--

- ** `\(E[\hat{\beta}]={\bf D} E[y] = {\bf D}{\bf X}\beta= ({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}{\bf X}\beta = \beta\)` **

--

- ** `\(var(\hat{\beta})= {\bf D} \sigma^{2}{\bf D}^{\sf T}=({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}\sigma^{2}[({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}]^{\sf T} = \sigma^{2}({\bf X}^{\sf T}{\bf X})^{-1}{\bf X}^{\sf T}{\bf X}({\bf X}^{\sf T}{\bf X})^{-1}=\sigma^{2}({\bf X}^{\sf T}{\bf X})^{-1}\)` **


---
class: animated fadeIn 
### Advertising data: multiple linear regression

At this stage, no pre-processing, no test set evaluation, just fit the regression model on the whole data set 

** pre-processing: define a `\(\texttt{recipe}\)` **

```r
adv_recipe = recipe(sales~., data=adv_data)
```

** model specification define a `\(\texttt{parsnip}\)` ** model

```r
adv_model = linear_reg(mode="regression", engine="lm")
```

** define the `\(\texttt{workflow}\)` **


```r
adv_wflow = workflow() %&gt;% 
  add_recipe(recipe=adv_recipe) %&gt;% 
  add_model(adv_model)
```
** fit the model**

```r
adv_fit = adv_wflow %&gt;% 
  fit(data=adv_data)
```

---
class: animated fadeIn 
### Advertising data: back to single models

.pull-left[
&lt;table class="table" style="font-size: 10px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; medium &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 12.3514 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.6214 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 19.8761 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0547 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0166 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 3.2996 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0011 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 9.3116 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.5629 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 16.5422 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.2025 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0204 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 9.9208 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; (Intercept) &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 7.0326 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.4578 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 15.3603 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0475 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0027 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 17.6676 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]
.pull-right[
&lt;img src="Linear-Regression-part_1_files/figure-html/unnamed-chunk-5-1.png" width="75%" style="display: block; margin: auto;" /&gt;
]


---
class: animated fadeIn 
### Advertising data: single vs multiple regression

.pull-left[

```r
avd_lm_models_nest  %&gt;% unnest(model_params) %&gt;% 
  select(medium,term:p.value) %&gt;%
  filter(term!="(Intercept)") %&gt;% arrange(medium) %&gt;% 
  kbl(digits = 4) %&gt;% kable_styling(font_size = 12) %&gt;% 
  column_spec(c(3,6),bold=TRUE) %&gt;% 
  row_spec(1,background = "#D9FDEC") %&gt;% 
  row_spec(2,background = "#CAF6FC") %&gt;% 
  row_spec(3,background = "#FDB5BA") 
```

&lt;table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; medium &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #D9FDEC !important;"&gt; 0.0547 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0166 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 3.2996 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #D9FDEC !important;"&gt; 0.0011 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #CAF6FC !important;"&gt; 0.2025 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0204 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 9.9208 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; budget &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #FDB5BA !important;"&gt; 0.0475 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0027 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 17.6676 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]



.pull-right[

```r
adv_fit %&gt;% tidy() %&gt;% 
  filter(term!="(Intercept)") %&gt;% arrange(term) %&gt;% 
  kbl(digits = 4) %&gt;% kable_styling(font_size = 12) %&gt;% 
  column_spec(c(2,5),bold=TRUE) %&gt;% 
  row_spec(1,background = "#D9FDEC") %&gt;% 
  row_spec(2,background = "#CAF6FC") %&gt;% 
  row_spec(3,background = "#FDB5BA") 
```

&lt;table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; term &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; estimate &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; std.error &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; statistic &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; p.value &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #D9FDEC !important;"&gt; newspaper &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #D9FDEC !important;"&gt; -0.0010 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; 0.0059 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #D9FDEC !important;"&gt; -0.1767 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #D9FDEC !important;"&gt; 0.8599 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #CAF6FC !important;"&gt; radio &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #CAF6FC !important;"&gt; 0.1885 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 0.0086 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #CAF6FC !important;"&gt; 21.8935 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #CAF6FC !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;background-color: #FDB5BA !important;"&gt; TV &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #FDB5BA !important;"&gt; 0.0458 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 0.0014 &lt;/td&gt;
   &lt;td style="text-align:right;background-color: #FDB5BA !important;"&gt; 32.8086 &lt;/td&gt;
   &lt;td style="text-align:right;font-weight: bold;background-color: #FDB5BA !important;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

&amp;nbsp;
&amp;nbsp;

.center[** why these (apparently) contradictory results? **]


---
class: animated fadeIn 
### Advertising data: single vs multiple regression



```r
library("corrr")
adv_data %&gt;% correlate()  %&gt;%  network_plot()
```

&lt;img src="Linear-Regression-part_1_files/figure-html/unnamed-chunk-6-1.png" width="30%" style="display: block; margin: auto;" /&gt;



**Note**:

- ** `\(\texttt{newspaper}\)` ** is correlated with ** `\(\texttt{radio}\)` **, the latter having a significative effect on ** `\(\texttt{radio}\)` ** in the multiple regression model

--

- that is why, in the single model, ** `\(\texttt{newspaper}\)` ** has a significant effect ** `\(\texttt{sales}\)` ** (** `\(\texttt{radio}\)` ** is ignored) 



---
class: animated fadeIn center middle inverse

# regression by successive orthogonalisations

---
class: animated fadeIn center middle inverse

### computing multiple regression coefficients
### by means of single regressions


---
class: animated fadeIn
### Algebraic formalization of single regression
  
Consider the data to be centered ** `\(\bar{y}=\bar{x}=0\)` **: this means that ** `\(\beta_{0}=0\)` ** (no intercept model),
** `\({\bf y}=\beta_{1}{\bf x}+\epsilon\)` **

--

The ** `\(\hat{\beta}_{1}\)` ** estimator

** `$$\hat{\beta}_{1}=\frac{\sum_{i}^{n}{x_{i}y_{i}}}{\sum_{i}^{n}{x_{i}^{2}}}=\frac{{\bf x}^{\sf T}{\bf y}}{{\bf x}^{\sf T}{\bf x}}=\frac{\langle {\bf x},{\bf y}\rangle}{\langle {\bf x},{\bf x}\rangle}$$` **

`\({\langle {\bf a},{\bf b}\rangle}\)` is the inner product  `\({\bf a}^{\sf T}{\bf b}\)`.

--

Consider the two predictors model ** `\(y = \beta_{1}X_{1}+\beta_{2}X_{2}+\epsilon\)` **

- **Note**  if the two predictors are such that `\({\bf x}_{1}^{\sf T}{\bf x}_{2} = 0\)` then ** `\(\hat{\beta}_{1}\)` ** and ** `\(\hat{\beta}_{2}\)` ** can be computed by
    - fitting the multiple regression ** `\(y = \beta_{1}X_{1}+\beta_{2}X_{2}+\epsilon\)` **
    - fitting the single regressions ** `\(y = \beta_{1}X_{1}+\epsilon\)` ** and ** `\(y = \beta_{2}X_{2}+\epsilon\)` **


---
class: animated fadeIn
### the orthogonal predictors case

Check the previous claim, given the predictors matrix

`$${\bf X}=\left[{
\begin{bmatrix}
\\
 \\
{\bf x}_{1} \\
 \\
 \\
 \end{bmatrix}
\begin{bmatrix}
\\
 \\
{\bf x}_{2} \\
 \\
 \\
 \end{bmatrix}}
 \right]$$`

and that 

 ** `$${\bf \hat{\beta}}=\left({\bf X}^{\sf T}{\bf X}\right)^{-1}{\bf X}^{\sf T}{\bf y} \rightarrow \left({\bf X}^{\sf T}{\bf X}\right)\hat{\beta} - {\bf X}^{\sf T}{\bf y}={\bf X}^{\sf T}\left({\bf X}\hat{\beta} - {\bf y}\right)=0$$` **



---
class: animated fadeIn
### the non-orthogonal predictors case

In real data, it is impossible to have all the predictors pair-wise orthogonal.

--

&amp;nbsp;

- single and multiple regression coefficients estimates will differ

--

&amp;nbsp;
&amp;nbsp;

- multiple regression coefficients estimates can still be obtained via single regressions via...

--

&amp;nbsp;
&amp;nbsp;

.center[ **successive orthogonalizations** ]


---
class: animated fadeIn
### Regression via  successive orthogonalizations

Consider the four predictors model (with no intercept)

** `$$y=\beta_{1}X_{1}+\beta_{2}X_{2}+\beta_{3}X_{3}+\beta_{4}X_{4}+\epsilon$$` **

--

** Compute the value for `\(\hat{\beta}_{4}\)` using successive orthogonalizations **

&amp;nbsp;
set ** `\({\bf z}_{1}={\bf x}_{1}\)` ** 
&amp;nbsp;
&amp;nbsp;

.my-pull-left[

&amp;nbsp;
&amp;nbsp;

** step 1 **
]

.my-pull-right[
&gt;   - fit ** `\({\bf x}_{2}=\beta_{2|1}{\bf z}_{1}+\epsilon\)` ** 
&gt;
&gt;   - compute ** `\(\hat{\beta}_{2|1}=\frac{\langle {\bf z}_{1},{\bf x}_{2}\rangle}{\langle {\bf z}_{1},{\bf z}_{1}\rangle}\)` **
&gt;
&gt;   - compute ** `\({\bf z}_{2}=x_{2}-\hat{\beta}_{2|1}{\bf z}_{1}\)` **

]

---
class: animated fadeIn
### Regression via  successive orthogonalizations

Consider the four predictors model (with no intercept)

** `$$y=\beta_{1}X_{1}+\beta_{2}X_{2}+\beta_{3}X_{3}+\beta_{4}X_{4}+\epsilon$$` **



** Compute the value for `\(\hat{\beta}_{4}\)` using successive orthogonalizations **

&amp;nbsp;
&amp;nbsp;

.my-pull-left[

&amp;nbsp;
&amp;nbsp;

** step 2 **
]

.my-pull-right[
&gt;   - fit ** `\({\bf x}_{3}=\beta_{3|1}{\bf z}_{1}+\epsilon\)` ** and ** `\({\bf x}_{3}=\beta_{3|2}{\bf z}_{2}+\epsilon\)` ** 
&gt;
&gt;   - compute ** `\(\hat{\beta}_{3|1}=\frac{\langle {\bf z}_{1},{\bf x}_{3}\rangle}{\langle {\bf z}_{1},{\bf z}_{1}\rangle}\)` ** and ** `\(\hat{\beta}_{3|2}=\frac{\langle {\bf z}_{2},{\bf x}_{3}\rangle}{\langle {\bf z}_{2},{\bf z}_{2}\rangle}\)` **
&gt;
&gt;   - compute ** `\({\bf z}_{3}=x_{3}-\hat{\beta}_{3|1}{\bf z}_{1}-\hat{\beta}_{3|2}{\bf z}_{2}\)` ** 
]

---
class: animated fadeIn
### Regression via  successive orthogonalizations

Consider the four predictors model (with no intercept)

** `$$y=\beta_{1}X_{1}+\beta_{2}X_{2}+\beta_{3}X_{3}+\beta_{4}X_{4}+\epsilon$$` **



** Compute the value for `\(\hat{\beta}_{4}\)` using successive orthogonalizations **

&amp;nbsp;
&amp;nbsp;

.my-pull-left[

&amp;nbsp;
&amp;nbsp;

** step 3 **
]

.my-pull-right[
&gt;   - fit ** `\({\bf x}_{4}=\beta_{4|1}{\bf z}_{1}+\epsilon\)` **,** `\({\bf x}_{4}=\beta_{4|2}{\bf z}_{2}+\epsilon\)` ** and ** `\({\bf x}_{4}=\beta_{4|3}{\bf z}_{3}+\epsilon\)` ** 
&gt;
&gt;   - compute ** `\(\hat{\beta}_{4|1}=\frac{\langle {\bf z}_{1},{\bf x}_{4}\rangle}{\langle {\bf z}_{1},{\bf z}_{1}\rangle}\)` **, ** `\(\hat{\beta}_{4|2}=\frac{\langle {\bf z}_{2},{\bf x}_{4}\rangle}{\langle {\bf z}_{2},{\bf z}_{2}\rangle}\)` ** and ** `\(\hat{\beta}_{4|3}=\frac{\langle {\bf z}_{3},{\bf x}_{4}\rangle}{\langle {\bf z}_{3},{\bf z}_{3}\rangle}\)` **
&gt;
&gt;   - ** compute `\({\bf z}_{4}=x_{4}-\hat{\beta}_{4|1}{\bf z}_{1}-\hat{\beta}_{4|2}{\bf z}_{2}-\hat{\beta}_{4|3}{\bf z}_{3}\)` ** 
]


---
class: animated fadeIn
### Regression via  successive orthogonalizations

Consider the four predictors model (with no intercept)

** `$$y=\beta_{1}X_{1}+\beta_{2}X_{2}+\beta_{3}X_{3}+\beta_{4}X_{4}+\epsilon$$` **



** Compute the value for `\(\hat{\beta}_{4}\)` using successive orthogonalizations **

&amp;nbsp;
&amp;nbsp;

.my-pull-left[

&amp;nbsp;

** step 4 **
]

.my-pull-right[
&gt;   - fit ** `\({\bf y}=\beta_{4}{\bf z}_{4}+\epsilon\)` **
&gt;
&gt;   - compute ** `\(\hat{\beta}_{4}=\frac{\langle {\bf z}_{4},{\bf y}\rangle}{\langle {\bf z}_{4},{\bf z}_{4}\rangle}\)` **
]



---
class: animated fadeIn
### Regression via  successive orthogonalizations: a further look

- The residuals vector ** `\({\bf e}=\left({\bf y}-{\bf \hat{y}}\right)\)` ** is orthogonal to the predictor ** `\({\bf x}\)` **, that is
** `\(\left({\bf y}-{\bf \hat{y}}\right)^{\sf T}{\bf x}=0\)` **

`$$\begin{split}
({\bf y}-{\bf \hat{y}})^{\sf T}{\bf x}&amp;={\bf y}^{\sf T}{\bf x}-{\bf \hat{y}}^{\sf T}{\bf x} \\
&amp;={\bf y}^{\sf T}{\bf x} - \underbrace{({\bf  x} ({\bf  x}^{\sf  T}{\bf  x})^{-1}{\bf  x}^{\sf T}{\bf  y})^{\sf T}}_{\bf \hat{y}^{\sf T}}{\bf  x}= \\
&amp;={\bf y}^{\sf T}{\bf x}- {\bf  y}^{\sf  T}{\bf  x} ({\bf  x}^{\sf  T}{\bf  x})^{-1}{\bf  x}^{\sf T}{\bf  x}= {\bf  y}^{\sf  T}{\bf  x}- {\bf  y}^{\sf  T}{\bf  x}=0
\end{split}$$`

--

- recall that ** `\({\bf z}_{2}={\bf x}_{2}-\beta_{2|1}{\bf z}_{1}\)` **, the ** `\({\bf z}_{2}\)` ** is orthogonal to ** `\({\bf z}_{1}\)` **,
and since ** `\({\bf z}_{1}={\bf x}_{1}\)` **, ** `\({\bf z}_{2}\)` ** is orthogonal to ** `\({\bf x}_{1}\)` **, too.

--

-  ** `\({\bf z}_{2}\)` ** is  ** `\({\bf x}_{2}\)` ** _adjusted_  to be orthogonal to  `\({\bf z}_{1}\)` ( `\({\bf x}_{1}\)` ).

--

-  ** `\({\bf z}_{3}\)` ** is  ** `\({\bf x}_{3}\)` ** _adjusted_  to be orthogonal to  `\({\bf z}_{2}\)` and to `\({\bf z}_{1}\)`.

-  ** `\({\bf z}_{4}\)` ** is  ** `\({\bf x}_{4}\)` ** _adjusted_  to be orthogonal to `\({\bf z}_{3}\)`,  `\({\bf z}_{2}\)` and to `\({\bf z}_{1}\)`.

 ** the multiple regression-based `\(\hat{\beta}_{j}\)`  can be obtained via the single regression `\({\bf y}=\hat{\beta}_{j}{\bf z}_{j}+\epsilon\)` **
    -  ** `\({\bf z}_{j}\)` ** is  ** `\({\bf x}_{j}\)` ** _adjusted_  wrt to the other predictors.


---
class: animated fadeIn
### Regression via  successive orthogonalizations: some considerations

** the multiple regression-based `\(\hat{\beta}_{j}\)`  can be obtained via the single regression `\({\bf y}=\hat{\beta}_{j}{\bf z}_{j}+\epsilon\)` **


- If the predictors are pair-wise orthogonal, the single coefficients of the predictor `\(j\)` on the residual `\(i\)`, `\(\hat{\beta}_{j|i}=0\)` then 
 `\({\bf z}_{j}={\bf x}_{j},  j= 1,\ldots,p\)`. 
 
--
 
 - So ** `\(\hat{\beta}_{j}=\frac{\langle {\bf z}_{j}, {\bf y}\rangle}{\langle {\bf z}_{j}, {\bf z}_{j}\rangle}=\frac{\langle {\bf x}_{j}, {\bf y}\rangle}{\langle {\bf x}_{j}, {\bf x}_{j}\rangle}\)` **, just a single regression of `\({\bf y}\)` on `\({\bf x}_{j}\)`
 
--
 
- if ** `\({\bf x}_{j}\)` ** is correlated with one or more of the other predictors, the squared norm  ** `\(\|{\bf z}_{j}\|^{2}\approx 0\)` **   
    - this makes sense, since the predictor in question won't explain any new information on `\({\bf y}\)`
 
--
 
 - as ** `\(\|{\bf z}_{j}\|^{2} = \langle {\bf z}_{j}, {\bf z}_{j}\rangle\approx 0\)` **, the variability of the OLS estimator explodes, since ** `\(SE(\hat{\beta}_{j})=\frac{\sigma}{\sqrt{\|{\bf z}_{j}\|^{2}}}\)` **
 
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"navigation": {
"scroll": false
},
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
